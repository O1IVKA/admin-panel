{% include 'wrapper.html' %}
{%load templatetags%}

    <!--================Blog Area =================-->

    <section class="blog_categorie_area">
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <div class="blog_left_sidebar">

                        {%for post in object_list%}
                        <article class="row blog_item">
                            <!-- <div class="col-md-3">
                                <div class="blog_info text-right">

                                    <ul class="blog_meta list">
                                        <li><a href="#">{{post.author}}<i class="lnr lnr-user"></i></a></li>
                                        <li><a href="#">{{post.date|date:'d-m-Y'}}<i class="lnr lnr-calendar-full"></i></a></li>
                                        <li><a href="#">{{post.comments_count}} <i class="lnr lnr-bubble"></i></a></li>
                                    </ul>
                                </div>
                            </div> -->
                            <div class="col-md-12">
                                <div class="blog_post">
                                    <div class="blog-content">
                                        <div class="blog_info">
                                            <a href="#"><i class="lnr lnr-user"></i> {{post.author}}</a>
                                            <a href="{% url 'poster' post.slug %}">
                                                <h2 class="blog_title text-center">{{post.title}}</h2>
                                            </a>
                                            <span>{{post.date|date:'d-m-Y'}} <i
                                                    class="lnr lnr-calendar-full"></i></span>
                                        </div>
                                        {%if post.img%}
                                        <img src="{{post.img.url}}" alt="">
                                        {%endif%}
                                        <div class="blog_details">
                                            <p>MCSE boot camps have its supporters and its detractors. Some people do
                                                not
                                                understand why you should have to spend money on boot camp when you can
                                                get
                                                the MCSE study materials yourself at a fraction.</p>
                                        </div>
                                        <div class="blog_footer">
                                            <a href='{% url "poster" post.slug %}' class="blog_btn">Читать</a>
                                            <a href="#" class="blog_comments">{{post.comments.count}} <i class="lnr lnr-bubble"></i></a>
                                            <a href="#"  class="blog_likes {% if not request.user in post.likes.all %}un{% endif %}like" data-id="{{ post.id }}" data-action="{% if request.user in post.likes.all %}un{% endif %}like"><span>{{ post.likes.all.count }}</span><i class="far fa-heart "></i></a>
                                            <div class="tags">
                                            {% for tag in post.tags.all %}
                                                <a href="/blog?tags={{ tag.id }}">{{ tag.name }}</a>
                                            {% if not forloop.last %}, {% endif %}
                                            {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </article>
                        {%endfor%}
                            <div class="page-pagination">
                                {% if is_paginated %}
                {% if page_obj.has_previous %}
                     {% with page_obj.number|range_s|index:0 as min_page %}
                        {% if not min_page == 1%}
                            <a href="?{% param_replace page=1 %}" class="paginator-first">Назад Назад</a>
                        {% endif %}
                     {% endwith %}
                     {% if page_obj.previous_page_number != 1 %}
                    <a href="?{% param_replace page=page_obj.previous_page_number %}" class="paginator_previous"> <i class="far fa-angle-left"></i> Назад</a>
                    {% endif %}
                {% endif %}
                    <div class="page-list">
                    {% for i in page_obj.number|range_s %}
                        <a href="?{% param_replace page=i %}">{{ i }}</a>
                    {% endfor %}
                    {% for i in page_obj.number|range:paginator.num_pages %}
                    {% if forloop.first %}
                    <a class='active' href="?{% param_replace page=i %}">{{i}}</a>
                    {% else %}
                    <a  href="?{% param_replace page=i %}">{{i}}</a>
                    {% endif %}
                    {% endfor %}
                    </div>
                {% if page_obj.has_next %}
                    {% if page_obj.next_page_number != paginator.num_pages %}
                    <a href="?{% param_replace page=page_obj.next_page_number %}" class="paginator_next">Далее <i class="far fa-angle-right"></i></a>
                    {% endif %}
                    {% with page_obj.number|range:paginator.num_pages|index:-1 as max_page%}
                        {% if not max_page == paginator.num_pages %}
                            <a href="?{% param_replace page=paginator.num_pages %}" class="paginator_last">Далее Далее </a>
                        {% endif %}
                    {% endwith %}
                    {% endif %}
                {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="blog_right_sidebar">

 <aside class="single_sidebar_widget search_widget">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Search Posts">
                                <span class="input-group-btn">
                                    <button class="btn btn-default" type="button"><i class="lnr lnr-magnifier"></i></button>
                                </span>
                            </div><!-- /input-group -->
                            <div class="br"></div>
                        </aside>
    <aside class="single_sidebar_widget author_widget">
                            <img class="author_img rounded-circle" src="{{user.profile_img.url}}" alt="">
                            <h4>{{user.username}}</h4>
                            <p>{{user.email}}</p>
                            <div class="social_icon">
                                <a href="#"><i class="fa fa-facebook"></i></a>
                                <a href="#"><i class="fa fa-twitter"></i></a>
                                <a href="#"><i class="fa fa-github"></i></a>
                                <a href="#"><i class="fa fa-behance"></i></a>
                            </div>
                            <p>{{user.bio|safe}}</p>
                            <div class="br"></div>
                        </aside>
                        <aside class="single_sidebar_widget popular_post_widget">
                            <h3 class="widget_title">Popular Posts</h3>
                            <div class="media post_item">
                                <img src="static/new-img/blog/popular-post/post1.jpg" alt="post">
                                <div class="media-body">
                                    <a href="blog-details.html">
                                        <h3>Space The Final Frontier</h3>
                                    </a>
                                    <p>02 Hours ago</p>
                                </div>
                            </div>
                            <div class="media post_item">
                                <img src="static/new-img/blog/popular-post/post2.jpg" alt="post">
                                <div class="media-body">
                                    <a href="blog-details.html">
                                        <h3>The Amazing Hubble</h3>
                                    </a>
                                    <p>02 Hours ago</p>
                                </div>
                            </div>
                            <div class="media post_item">
                                <img src="static/new-img/blog/popular-post/post3.jpg" alt="post">
                                <div class="media-body">
                                    <a href="blog-details.html">
                                        <h3>Astronomy Or Astrology</h3>
                                    </a>
                                    <p>03 Hours ago</p>
                                </div>
                            </div>
                            <div class="media post_item">
                                <img src="static/new-img/blog/popular-post/post4.jpg" alt="post">
                                <div class="media-body">
                                    <a href="blog-details.html">
                                        <h3>Asteroids telescope</h3>
                                    </a>
                                    <p>01 Hours ago</p>
                                </div>
                            </div>
                            <div class="br"></div>
                        </aside>
                        <aside class="single_sidebar_widget ads_widget">
                            <a href="#"><img class="img-fluid" src="static/new-img/blog/add.jpg" alt=""></a>
                            <div class="br"></div>
                        </aside>

                        <aside class="single-sidebar-widget tag_cloud_widget">
                            <h4 class="widget_title">Tag Clouds</h4>
                            <div class="list">
                                <form method="get">
                                {{filterset.form}}
                                    <button type="submit">send</button>
                                </form>

                            </ul>
                        </aside>
                    </div>
                </div>
            </div>

        </div>
        
    </section>
    <style>
    </style>

        <!--================Blog Area =================-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script>
$('.blog_likes').each(function( index, element ) {
      $(element).click((el) => {
      var likeCount = $('el span');
      el.preventDefault();
      var target = el.target;
	$.ajax({
		headers:{'X-CSRFToken': Cookies.get('csrftoken'),
	             'Content-Type':'application/json',},
		url: '/like/',
		type: 'POST',
		dataType: 'json',
		data: JSON.stringify({
			id: $(element).data('id'),
			action: $(element).data('action')
			}),
		success: function(data) {
		    act = $(element).data('action')
			$(element).data('action', act == 'like' ? 'unlike' : 'like');
			var likeCount = element.firstChild;
			var count = parseInt($(likeCount).text());
			$(likeCount).text(act == 'like' ? count+1 : count-1);
			$(element).removeClass( "like" )
            $(element).removeClass( "unlike" ).addClass( act == 'like' ? 'like' : 'unlike' )
			
 		}

	});
});
});
</script>

{% include 'footer.html' %}
